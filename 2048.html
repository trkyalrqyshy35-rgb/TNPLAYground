<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<title>2048</title>
<style>
  body{font-family:Tahoma;background:#00c4ff;padding:30px;text-align:center}
  .board{display:inline-grid;grid-template-columns:repeat(4,80px);gap:8px;background:#bbb;padding:10px;border-radius:10px}
  .cell{background:#eee;height:80px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:20px;border-radius:6px}
  .controls{margin-top:12px}
  a{display:inline-block;margin-top:14px;padding:8px 14px;background:#333;color:#fff;text-decoration:none;border-radius:8px}
</style>
</head>
<body>
  <h1>2048</h1>
  <div class="board" id="board"></div>
  <div class="controls">استخدم أسهم لوحة المفاتيح لتحريك البلاطات</div>
  <a href="index.html">العودة إلى الصفحة الرئيسية</a>

<script>
let grid = Array(4).fill(null).map(()=>Array(4).fill(0));
const boardDiv = document.getElementById('board');

function spawn(){ 
  let empties=[];
  for(let r=0;r<4;r++) for(let c=0;c<4;c++) if(grid[r][c]===0) empties.push([r,c]);
  if(empties.length===0) return;
  let [r,c] = empties[Math.floor(Math.random()*empties.length)];
  grid[r][c] = Math.random()<0.9?2:4;
}

function draw(){
  boardDiv.innerHTML='';
  for(let r=0;r<4;r++){
    for(let c=0;c<4;c++){
      const div = document.createElement('div');
      div.className='cell';
      if(grid[r][c]!==0) div.innerText=grid[r][c];
      boardDiv.appendChild(div);
    }
  }
}

function slide(row){
  let arr = row.filter(v=>v!==0);
  for(let i=0;i<arr.length-1;i++){
    if(arr[i]===arr[i+1]){ arr[i]*=2; arr.splice(i+1,1); }
  }
  while(arr.length<4) arr.push(0);
  return arr;
}

function rotateClock(){
  let newG = Array(4).fill(null).map(()=>Array(4).fill(0));
  for(let r=0;r<4;r++) for(let c=0;c<4;c++) newG[c][3-r]=grid[r][c];
  grid=newG;
}

function moveLeft(){
  let moved=false;
  for(let r=0;r<4;r++){
    let before = grid[r].slice();
    grid[r] = slide(grid[r]);
    if(grid[r].toString()!==before.toString()) moved=true;
  }
  return moved;
}

function move(dir){ // 0 left, 1 up, 2 right, 3 down
  // normalize moves by rotating
  let rotated = 0;
  if(dir===1){ rotateClock(); rotated=1; } // up -> left
  if(dir===2){ rotateClock(); rotateClock(); rotated=2; } // right -> left
  if(dir===3){ rotateClock(); rotateClock(); rotateClock(); rotated=3; } // down -> left
  let moved = moveLeft();
  // rotate back
  for(let i=0;i<rotated;i++) rotateClock();
  if(moved) spawn();
  draw();
  checkLose();
}

function checkLose(){
  for(let r=0;r<4;r++) for(let c=0;c<4;c++) if(grid[r][c]===0) return;
  // check any merge possible
  for(let r=0;r<4;r++) for(let c=0;c<4;c++){
    if((r<3 && grid[r][c]===grid[r+1][c]) || (c<3 && grid[r][c]===grid[r][c+1])) return;
  }
  setTimeout(()=>alert('Game Over'),10);
}

document.addEventListener('keydown', e=>{
  if(e.key==='ArrowLeft') move(0);
  if(e.key==='ArrowUp') move(1);
  if(e.key==='ArrowRight') move(2);
  if(e.key==='ArrowDown') move(3);
});

function start(){
  grid = Array(4).fill(null).map(()=>Array(4).fill(0));
  spawn(); spawn();
  draw();
}
start();
</script>
</body>
</html>
